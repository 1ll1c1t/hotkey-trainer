<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GCG9LQ68MW"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-GCG9LQ68MW");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ultimate VS Code Hotkey Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .gradient-text {
        background: linear-gradient(135deg, #007acc 0%, #1e40af 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .active-mode {
        background: linear-gradient(135deg, #007acc 0%, #1e40af 100%);
        color: white !important;
      }
      .correct {
        background-color: #10b981 !important;
        color: white !important;
        border-color: #059669 !important;
      }
      .incorrect {
        background-color: #ef4444 !important;
        color: white !important;
        border-color: #b91c1c !important;
      }
      .option-btn {
        transition: all 0.2s;
        border: 2px solid #f3f4f6;
      }
      .option-btn:hover:not(:disabled) {
        border-color: #007acc;
        background-color: #eff6ff;
        transform: translateY(-2px);
      }
      .hotkey-card {
        transition: all 0.2s ease;
      }
      .custom-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .custom-scroll::-webkit-scrollbar-thumb {
        background: #007acc;
        border-radius: 10px;
      }
      .key-tag {
        font-family: "Monaco", "Consolas", monospace;
        font-size: 0.85rem;
      }
      .streak-pill {
        font-size: 0.6rem;
        font-weight: 900;
        padding: 2px 8px;
        border-radius: 99px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <!-- PayPal Donation Form -->
    <div
      class="bg-gray-100 py-3 border-b border-gray-200 flex justify-center items-center sticky top-0 z-[100]"
    >
      <form action="https://www.paypal.com/donate" method="post" target="_top">
        <input type="hidden" name="hosted_button_id" value="RSW8PUWLJJ8DC" />
        <input
          type="image"
          src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif"
          border="0"
          name="submit"
          title="PayPal - The safer, easier way to pay online!"
          alt="Donate with PayPal button"
        />
        <img
          alt=""
          border="0"
          src="https://www.paypal.com/en_US/i/scr/pixel.gif"
          width="1"
          height="1"
        />
      </form>
    </div>

    <nav
      class="bg-white/90 backdrop-blur-md border-b sticky top-[52px] z-50 px-6 py-4 flex justify-between items-center shadow-sm"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black shadow-lg text-sm"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m18 16 4-4-4-4"></path>
            <path d="m6 8-4 4 4 4"></path>
            <path d="m14.5 4-5 16"></path>
          </svg>
        </div>
        <a
          href="index.html"
          class="font-bold text-2xl tracking-tighter gradient-text"
          >Hotkey Trainer</a
        >
      </div>
      <a
        href="index.html"
        class="text-gray-600 hover:text-blue-600 transition-colors font-medium flex items-center gap-2"
      >
        <span>üè†</span> Home
      </a>
    </nav>

    <header
      class="bg-gradient-to-br from-blue-700 to-indigo-900 text-white py-14 text-center shadow-inner relative overflow-hidden"
    >
      <div
        class="absolute inset-0 opacity-10 pointer-events-none select-none text-[20rem] font-black -top-20 -right-10"
      >
        CODE
      </div>
      <h1 class="text-6xl font-black mb-2 tracking-tight">VS Code</h1>
      <p class="text-xl opacity-90 font-medium tracking-wide">
        Elite Development Workflow Mastery.
      </p>
    </header>

    <main
      class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-4 gap-8"
    >
      <!-- Sidebar Navigation -->
      <div class="lg:col-span-1 space-y-4">
        <div
          class="bg-white rounded-3xl p-6 shadow-xl border border-gray-100 sticky top-40"
        >
          <h3
            class="text-sm font-black mb-4 text-gray-400 uppercase tracking-widest px-2"
          >
            Workspaces
          </h3>
          <div
            class="space-y-1 max-h-[55vh] overflow-y-auto custom-scroll pr-2"
          >
            <button
              onclick="setMode('all')"
              id="mode-all"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl active-mode transition-all font-bold"
            >
              ‚å®Ô∏è All Keys
            </button>
            <button
              onclick="setMode('General')"
              id="mode-General"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              ‚öôÔ∏è Commands & Files
            </button>
            <button
              onclick="setMode('Editing')"
              id="mode-Editing"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              ‚úÇÔ∏è Basic Editing
            </button>
            <button
              onclick="setMode('Selection')"
              id="mode-Selection"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              ‚ú® Multi-Cursor
            </button>
            <button
              onclick="setMode('Navigation')"
              id="mode-Navigation"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold text-blue-600"
            >
              üß≠ Navigation
            </button>
            <button
              onclick="setMode('Terminal')"
              id="mode-Terminal"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              üêö Terminal & Git
            </button>
            <button
              onclick="setMode('View')"
              id="mode-View"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              üñ•Ô∏è UI & Layout
            </button>
            <div class="h-px bg-gray-100 my-4"></div>
            <button
              onclick="setMode('quiz')"
              id="mode-quiz"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-blue-600 hover:text-white transition-all font-black text-blue-600"
            >
              üß† Start Pro Gauntlet
            </button>
            <button
              onclick="setMode('insights')"
              id="mode-insights"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-gray-100 transition-all font-semibold"
            >
              üìä Mastery Stats
            </button>
          </div>

          <div class="mt-8 pt-6 border-t border-gray-200 px-2">
            <h4
              class="text-[10px] font-black mb-3 text-gray-400 uppercase tracking-widest"
            >
              Global Status
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-end">
                <span class="text-xs text-gray-500 font-bold">Progress</span>
                <span class="font-black text-blue-600" id="mastered-count"
                  >0</span
                >
              </div>
              <div class="w-full bg-gray-100 rounded-full h-3">
                <div
                  class="bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all duration-700 shadow-sm"
                  style="width: 0%"
                  id="progress-bar"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="lg:col-span-3">
        <div id="browser-view">
          <div
            class="bg-white rounded-3xl p-6 shadow-xl border border-gray-100 mb-8"
          >
            <div class="relative">
              <input
                type="text"
                id="search-input"
                placeholder="Search VS Code hotkeys (e.g. 'Terminal', 'F1', 'Git')..."
                class="w-full px-6 py-4 pl-14 border border-gray-100 rounded-2xl bg-gray-50 focus:ring-4 focus:ring-blue-200 outline-none transition-all text-lg font-medium"
              />
              <div
                class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl"
              >
                üîç
              </div>
            </div>
          </div>
          <div
            id="hotkeys-container"
            class="grid grid-cols-1 md:grid-cols-2 gap-4"
          ></div>
        </div>

        <div id="quiz-container" class="hidden">
          <div
            class="bg-white rounded-[3.5rem] p-12 shadow-2xl text-center border border-gray-100 min-h-[550px] flex flex-col justify-center"
          >
            <span
              class="bg-blue-100 text-blue-600 px-6 py-2 rounded-full text-xs font-black uppercase tracking-widest inline-block mx-auto mb-10"
              >Coding Gauntlet</span
            >
            <h2 class="text-gray-400 font-bold mb-2 uppercase text-xs">
              Identify the hotkey for:
            </h2>
            <h2
              id="quiz-question"
              class="text-4xl md:text-5xl font-black text-gray-900 mb-14 leading-tight"
            >
              Loading...
            </h2>

            <div
              id="quiz-options"
              class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10"
            ></div>

            <div
              id="quiz-feedback"
              class="hidden p-8 rounded-3xl font-black text-2xl mb-8 transform transition-all duration-300"
            ></div>
            <button
              id="next-question-btn"
              onclick="nextQuestion()"
              class="hidden mx-auto bg-gray-900 text-white px-20 py-6 rounded-3xl font-black text-xl hover:bg-blue-600 transition-all hover:scale-105 shadow-2xl"
            >
              NEXT CHALLENGE ‚Üí
            </button>

            <div class="grid grid-cols-2 gap-6 mt-16 border-t pt-10">
              <div class="p-4 bg-green-50 rounded-2xl border border-green-100">
                <p
                  class="text-[10px] font-black text-green-600 uppercase tracking-widest"
                >
                  Correct
                </p>
                <p
                  id="correct-count"
                  class="text-4xl font-black text-green-500"
                >
                  0
                </p>
              </div>
              <div class="p-4 bg-red-50 rounded-2xl border border-red-100">
                <p
                  class="text-[10px] font-black text-red-600 uppercase tracking-widest"
                >
                  Misses
                </p>
                <p
                  id="incorrect-count"
                  class="text-4xl font-black text-red-500"
                >
                  0
                </p>
              </div>
            </div>
          </div>
        </div>

        <div id="insights-container" class="hidden">
          <div
            class="bg-white p-12 rounded-[3.5rem] shadow-2xl border border-gray-100 text-center"
          >
            <h2 class="text-3xl font-black mb-8 gradient-text font-black">
              Subconscious Mastery Analysis
            </h2>
            <div id="progress-chart" class="h-96 w-full mb-10"></div>

            <div class="max-w-3xl mx-auto text-left">
              <div class="flex items-center justify-between mb-6">
                <h3
                  class="text-xl font-black text-gray-800 uppercase tracking-tighter flex items-center gap-2"
                >
                  <span>üöÄ</span> Streak-Earned Mastery
                </h3>
                <span class="text-xs font-bold text-gray-400"
                  >Items identified 5x correctly</span
                >
              </div>
              <div
                id="streak-list"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"
              >
                <!-- Items Injected -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-gray-900 text-white py-12 mt-12">
      <div class="max-w-7xl mx-auto px-4 text-center">
        <p class="text-gray-500 text-sm mb-4">
          Master your workflow, build the future.
        </p>
        <p class="text-gray-400 text-xs">
          ¬© 2025 thethreeplays.com. All rights reserved.
        </p>
      </div>
    </footer>

    <script>
      const hotkeysData = [
        // --- GENERAL & COMMANDS ---
        { func: "Command Palette", key: "Ctrl + Shift + P", cat: "General" },
        { func: "Quick Open (File Search)", key: "Ctrl + P", cat: "General" },
        {
          func: "New Window/Instance",
          key: "Ctrl + Shift + N",
          cat: "General",
        },
        {
          func: "Close Window/Instance",
          key: "Ctrl + Shift + W",
          cat: "General",
        },
        { func: "User Settings", key: "Ctrl + ,", cat: "General" },
        {
          func: "Keyboard Shortcuts Menu",
          key: "Ctrl + K Ctrl + S",
          cat: "General",
        },
        { func: "Show Task Runner", key: "Ctrl + Alt + T", cat: "General" },
        { func: "Save File", key: "Ctrl + S", cat: "General" },
        { func: "Save All Files", key: "Ctrl + K S", cat: "General" },
        { func: "Undo", key: "Ctrl + Z", cat: "General" },
        { func: "Redo", key: "Ctrl + Y", cat: "General" },
        { func: "New File", key: "Ctrl + N", cat: "General" },
        { func: "Open File", key: "Ctrl + O", cat: "General" },
        { func: "Close Active Editor", key: "Ctrl + W", cat: "General" },
        {
          func: "Reopen Closed Editor",
          key: "Ctrl + Shift + T",
          cat: "General",
        },

        // --- BASIC EDITING ---
        { func: "Cut Line (Empty Selection)", key: "Ctrl + X", cat: "Editing" },
        {
          func: "Copy Line (Empty Selection)",
          key: "Ctrl + C",
          cat: "Editing",
        },
        { func: "Move Line Up", key: "Alt + Up", cat: "Editing" },
        { func: "Move Line Down", key: "Alt + Down", cat: "Editing" },
        { func: "Copy Line Up", key: "Shift + Alt + Up", cat: "Editing" },
        { func: "Copy Line Down", key: "Shift + Alt + Down", cat: "Editing" },
        { func: "Delete Line", key: "Ctrl + Shift + K", cat: "Editing" },
        {
          func: "Insert Line Above",
          key: "Ctrl + Shift + Enter",
          cat: "Editing",
        },
        { func: "Insert Line Below", key: "Ctrl + Enter", cat: "Editing" },
        {
          func: "Jump to Matching Bracket",
          key: "Ctrl + Shift + \\",
          cat: "Editing",
        },
        { func: "Indent Line", key: "Ctrl + ]", cat: "Editing" },
        { func: "Outdent Line", key: "Ctrl + [", cat: "Editing" },
        { func: "Go to Start of Line", key: "Home", cat: "Editing" },
        { func: "Go to End of Line", key: "End", cat: "Editing" },
        { func: "Go to Start of File", key: "Ctrl + Home", cat: "Editing" },
        { func: "Go to End of File", key: "Ctrl + End", cat: "Editing" },
        { func: "Toggle Line Comment", key: "Ctrl + /", cat: "Editing" },
        {
          func: "Toggle Block Comment",
          key: "Shift + Alt + A",
          cat: "Editing",
        },
        {
          func: "Fold (Collapse) Region",
          key: "Ctrl + Shift + [",
          cat: "Editing",
        },
        {
          func: "Unfold (Expand) Region",
          key: "Ctrl + Shift + ]",
          cat: "Editing",
        },
        { func: "Fold All Regions", key: "Ctrl + K Ctrl + 0", cat: "Editing" },
        {
          func: "Unfold All Regions",
          key: "Ctrl + K Ctrl + J",
          cat: "Editing",
        },
        { func: "Format Document", key: "Shift + Alt + F", cat: "Editing" },
        { func: "Format Selection", key: "Ctrl + K Ctrl + F", cat: "Editing" },

        // --- MULTI-CURSOR & SELECTION ---
        { func: "Add Cursor Above", key: "Ctrl + Alt + Up", cat: "Selection" },
        {
          func: "Add Cursor Below",
          key: "Ctrl + Alt + Down",
          cat: "Selection",
        },
        { func: "Select Next Occurrence", key: "Ctrl + D", cat: "Selection" },
        {
          func: "Select Previous Occurrence",
          key: "Ctrl + K Ctrl + D",
          cat: "Selection",
        },
        {
          func: "Select All Occurrences of Current Selection",
          key: "Ctrl + Shift + L",
          cat: "Selection",
        },
        {
          func: "Insert Cursor at End of Each Line Selected",
          key: "Shift + Alt + I",
          cat: "Selection",
        },
        { func: "Select Current Line", key: "Ctrl + L", cat: "Selection" },
        {
          func: "Shrink Selection",
          key: "Shift + Alt + Left",
          cat: "Selection",
        },
        {
          func: "Expand Selection",
          key: "Shift + Alt + Right",
          cat: "Selection",
        },
        {
          func: "Column (Box) Selection",
          key: "Shift + Alt + Drag",
          cat: "Selection",
        },

        // --- NAVIGATION ---
        { func: "Go to Line Number", key: "Ctrl + G", cat: "Navigation" },
        {
          func: "Go to Symbol in File",
          key: "Ctrl + Shift + O",
          cat: "Navigation",
        },
        {
          func: "Go to Symbol in Workspace",
          key: "Ctrl + T",
          cat: "Navigation",
        },
        {
          func: "Show Problems Panel",
          key: "Ctrl + Shift + M",
          cat: "Navigation",
        },
        { func: "Next Error/Warning", key: "F8", cat: "Navigation" },
        {
          func: "Previous Error/Warning",
          key: "Shift + F8",
          cat: "Navigation",
        },
        {
          func: "Go Back (Navigation History)",
          key: "Alt + Left",
          cat: "Navigation",
        },
        {
          func: "Go Forward (Navigation History)",
          key: "Alt + Right",
          cat: "Navigation",
        },
        { func: "Go to Definition", key: "F12", cat: "Navigation" },
        { func: "Peek Definition", key: "Alt + F12", cat: "Navigation" },
        { func: "Go to References", key: "Shift + F12", cat: "Navigation" },
        { func: "Rename Symbol (Refactor)", key: "F2", cat: "Navigation" },
        {
          func: "Peek Type Definition",
          key: "Ctrl + Shift + F10",
          cat: "Navigation",
        },

        // --- SEARCH & REPLACE ---
        { func: "Find", key: "Ctrl + F", cat: "General" },
        { func: "Replace", key: "Ctrl + H", cat: "General" },
        { func: "Find Next", key: "F3", cat: "General" },
        { func: "Find Previous", key: "Shift + F3", cat: "General" },
        {
          func: "Select All Occurrences of Find Match",
          key: "Alt + Enter",
          cat: "General",
        },

        // --- TERMINAL & GIT ---
        {
          func: "Toggle Integrated Terminal",
          key: "Ctrl + `",
          cat: "Terminal",
        },
        {
          func: "Create New Terminal",
          key: "Ctrl + Shift + `",
          cat: "Terminal",
        },
        { func: "Scroll Terminal Up", key: "Ctrl + Up", cat: "Terminal" },
        { func: "Scroll Terminal Down", key: "Ctrl + Down", cat: "Terminal" },
        { func: "Page Up Terminal", key: "Shift + PgUp", cat: "Terminal" },
        { func: "Page Down Terminal", key: "Shift + PgDn", cat: "Terminal" },
        {
          func: "Show Source Control (Git)",
          key: "Ctrl + Shift + G",
          cat: "Terminal",
        },
        {
          func: "Git: Stage Selected Changes",
          key: "Ctrl + K Ctrl + Alt + S",
          cat: "Terminal",
        },

        // --- VIEW & UI ---
        { func: "Toggle Side Bar", key: "Ctrl + B", cat: "View" },
        { func: "Toggle Full Screen", key: "F11", cat: "View" },
        { func: "Zen Mode", key: "Ctrl + K Z", cat: "View" },
        { func: "Toggle Word Wrap", key: "Alt + Z", cat: "View" },
        { func: "Zoom In UI", key: "Ctrl + =", cat: "View" },
        { func: "Zoom Out UI", key: "Ctrl + -", cat: "View" },
        { func: "Reset Zoom", key: "Ctrl + Num 0", cat: "View" },
        { func: "Split Editor", key: "Ctrl + \\", cat: "View" },
        { func: "Focus Group 1", key: "Ctrl + 1", cat: "View" },
        { func: "Focus Group 2", key: "Ctrl + 2", cat: "View" },
        { func: "Focus Group 3", key: "Ctrl + 3", cat: "View" },
        { func: "Show Explorer", key: "Ctrl + Shift + E", cat: "View" },
        { func: "Show Search", key: "Ctrl + Shift + F", cat: "View" },
        { func: "Show Debug Panel", key: "Ctrl + Shift + D", cat: "View" },
        { func: "Show Extensions", key: "Ctrl + Shift + X", cat: "View" },
        { func: "Show Output Panel", key: "Ctrl + Shift + U", cat: "View" },
      ];

      let userProgress = {
        mastered: new Set(),
        streakCount: {},
      };
      let quizPool = [];
      let currentIdx = 0;
      let stats = { correct: 0, incorrect: 0 };
      let currentFilter = "all";

      function init() {
        loadMastery();
        renderHotkeys();
        setupSearch();
      }

      function setMode(mode) {
        document
          .querySelectorAll(".mode-btn")
          .forEach((btn) => btn.classList.remove("active-mode"));
        const targetBtn = document.getElementById(`mode-${mode}`);
        if (targetBtn) targetBtn.classList.add("active-mode");

        const views = {
          "browser-view": document.getElementById("browser-view"),
          "quiz-container": document.getElementById("quiz-container"),
          "insights-container": document.getElementById("insights-container"),
        };

        Object.values(views).forEach((v) => v.classList.add("hidden"));

        if (mode === "quiz") {
          views["quiz-container"].classList.remove("hidden");
          startQuiz();
        } else if (mode === "insights") {
          views["insights-container"].classList.remove("hidden");
          drawInsights();
        } else {
          views["browser-view"].classList.remove("hidden");
          currentFilter = mode;
          renderHotkeys();
        }
      }

      function updateStats() {
        const mCount = userProgress.mastered.size;
        const total = hotkeysData.length;
        const masteredEl = document.getElementById("mastered-count");
        const progressEl = document.getElementById("progress-bar");
        if (masteredEl) masteredEl.innerText = mCount + " / " + total;
        if (progressEl)
          progressEl.style.width = Math.round((mCount / total) * 100) + "%";
      }

      function renderHotkeys(search = "") {
        const container = document.getElementById("hotkeys-container");
        container.innerHTML = "";
        let filtered = hotkeysData;
        if (currentFilter !== "all")
          filtered = filtered.filter((h) => h.cat === currentFilter);
        if (search)
          filtered = filtered.filter(
            (h) =>
              h.func.toLowerCase().includes(search.toLowerCase()) ||
              h.key.toLowerCase().includes(search.toLowerCase())
          );

        filtered.forEach((h) => {
          const card = document.createElement("div");
          const mastered = userProgress.mastered.has(h.func);
          const streak = userProgress.streakCount[h.func] || 0;

          card.className = `hotkey-card bg-white p-6 rounded-3xl border ${
            mastered
              ? "border-blue-500 bg-blue-50 shadow-blue-100"
              : "border-gray-100 shadow-sm"
          } flex justify-between items-center group transition-all`;

          let streakHtml = "";
          if (mastered) {
            streakHtml = `<span class="streak-pill bg-blue-500 text-white">Mastered</span>`;
          } else if (streak > 0) {
            streakHtml = `<span class="streak-pill bg-blue-100 text-blue-600">Streak: ${streak}/5</span>`;
          }

          card.innerHTML = `
                    <div class="flex-grow">
                        <div class="flex items-center gap-2 mb-1">
                            <p class="text-[9px] font-black text-gray-300 uppercase group-hover:text-blue-500">${
                              h.cat
                            }</p>
                            ${streakHtml}
                        </div>
                        <h4 class="text-md font-bold text-gray-800">${
                          h.func
                        }</h4>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="key-tag bg-gray-900 border border-gray-700 px-3 py-1.5 rounded-xl text-purple-400 font-bold shadow-lg whitespace-nowrap">${
                          h.key
                        }</span>
                        <button onclick="toggleStar('${
                          h.func
                        }')" class="text-2xl transform hover:scale-125 transition-transform">${
            mastered ? "‚≠ê" : "‚òÜ"
          }</button>
                    </div>`;
          container.appendChild(card);
        });
        updateStats();
      }

      function startQuiz() {
        quizPool = [...hotkeysData];
        shuffle(quizPool);
        currentIdx = 0;
        stats = { correct: 0, incorrect: 0 };
        document.getElementById("correct-count").innerText = "0";
        document.getElementById("incorrect-count").innerText = "0";
        loadQuestion();
      }

      function loadQuestion() {
        const q = quizPool[currentIdx];
        document.getElementById("quiz-question").innerText = q.func;
        document.getElementById("quiz-feedback").classList.add("hidden");
        document.getElementById("next-question-btn").classList.add("hidden");
        const options = document.getElementById("quiz-options");
        options.innerHTML = "";
        options.classList.remove("pointer-events-none");

        let choices = [q.key];
        while (choices.length < 4) {
          let r =
            hotkeysData[Math.floor(Math.random() * hotkeysData.length)].key;
          if (!choices.includes(r)) choices.push(r);
        }
        shuffle(choices);

        choices.forEach((c) => {
          const btn = document.createElement("button");
          btn.className =
            "option-btn p-6 rounded-3xl font-black text-xl bg-white shadow-md";
          btn.innerText = c;
          btn.onclick = () => {
            const isCorrect = c === q.key;
            options.classList.add("pointer-events-none");
            btn.classList.add(isCorrect ? "correct" : "incorrect");

            if (isCorrect) {
              stats.correct++;
              userProgress.streakCount[q.func] =
                (userProgress.streakCount[q.func] || 0) + 1;
              if (
                userProgress.streakCount[q.func] >= 5 &&
                !userProgress.mastered.has(q.func)
              ) {
                userProgress.mastered.add(q.func);
              }
            } else {
              stats.incorrect++;
              userProgress.streakCount[q.func] = 0;
              document.querySelectorAll(".option-btn").forEach((b) => {
                if (b.innerText === q.key) b.classList.add("correct");
              });
            }

            saveMastery();
            const feed = document.getElementById("quiz-feedback");
            feed.innerText = isCorrect
              ? "PERFECT! Workflow optimized."
              : "The hotkey is: " + q.key;
            feed.className = `p-8 rounded-3xl font-black text-2xl mb-8 border-4 ${
              isCorrect
                ? "bg-green-50 text-green-700 border-green-200"
                : "bg-red-50 text-red-700 border-red-200"
            }`;
            feed.classList.remove("hidden");
            document
              .getElementById("next-question-btn")
              .classList.remove("hidden");
            document.getElementById("correct-count").innerText = stats.correct;
            document.getElementById("incorrect-count").innerText =
              stats.incorrect;
            updateStats();
          };
          options.appendChild(btn);
        });
      }

      function nextQuestion() {
        currentIdx++;
        if (currentIdx < quizPool.length) loadQuestion();
        else startQuiz();
      }

      function toggleStar(f) {
        if (userProgress.mastered.has(f)) {
          userProgress.mastered.delete(f);
          userProgress.streakCount[f] = 0;
        } else {
          userProgress.mastered.add(f);
          userProgress.streakCount[f] = 5;
        }
        saveMastery();
        renderHotkeys();
      }

      function setupSearch() {
        document
          .getElementById("search-input")
          .addEventListener("input", (e) => renderHotkeys(e.target.value));
      }
      function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
      }

      function saveMastery() {
        localStorage.setItem(
          "mastery-vscode-v12-final",
          JSON.stringify({
            mastered: [...userProgress.mastered],
            streaks: userProgress.streakCount,
          })
        );
      }

      function loadMastery() {
        const s = localStorage.getItem("mastery-vscode-v12-final");
        if (s) {
          const data = JSON.parse(s);
          userProgress.mastered = new Set(data.mastered || []);
          userProgress.streakCount = data.streaks || {};
        }
      }

      function drawInsights() {
        const m = userProgress.mastered.size;
        const r = hotkeysData.length - m;

        if (typeof Plotly !== "undefined") {
          Plotly.newPlot(
            "progress-chart",
            [
              {
                values: [m, r],
                labels: ["Mastered", "Remaining"],
                type: "pie",
                marker: { colors: ["#007acc", "#f1f1f1"] },
                hole: 0.5,
              },
            ],
            {
              margin: { t: 0, b: 0, l: 0, r: 0 },
              paper_bgcolor: "rgba(0,0,0,0)",
              plot_bgcolor: "rgba(0,0,0,0)",
            }
          );
        }

        const list = document.getElementById("streak-list");
        list.innerHTML = "";
        let streakItemsCount = 0;

        Object.entries(userProgress.streakCount).forEach(([name, count]) => {
          if (count >= 5) {
            streakItemsCount++;
            const item = document.createElement("div");
            item.className =
              "bg-green-50 border border-green-100 p-4 rounded-2xl flex justify-between items-center shadow-sm animate-in slide-in-from-bottom duration-500";
            item.innerHTML = `<span class="font-bold text-green-800 text-xs">${name}</span><span class="bg-green-500 text-white text-[8px] px-2 py-0.5 rounded-lg font-black uppercase italic">MASTER</span>`;
            list.appendChild(item);
          }
        });

        if (streakItemsCount === 0) {
          list.innerHTML =
            '<div class="col-span-3 p-8 text-center bg-gray-50 rounded-3xl border-2 border-dashed border-gray-200"><p class="text-gray-400 text-sm font-medium">Get a 5-streak in the Gauntlet to graduate keys to mastery.</p></div>';
        }
        updateStats();
      }

      window.onload = () => {
        init();
      };
    </script>
  </body>
</html>
