<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GCG9LQ68MW"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-GCG9LQ68MW");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LazyVim Hotkey Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Tokyo Night Theme Adaptation */
      body {
        font-family: "Inter", sans-serif;
        background-color: #1a1b26;
        color: #c0caf5;
      }
      .font-mono {
        font-family: "JetBrains Mono", monospace;
      }
      .gradient-text {
        background: linear-gradient(135deg, #7aa2f7 0%, #bb9af7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .active-mode {
        background: linear-gradient(135deg, #7aa2f7 0%, #bb9af7 100%);
        color: #1a1b26 !important;
        font-weight: 800;
        border: 1px solid #7aa2f7;
      }
      .correct {
        background-color: #9ece6a !important;
        color: #1a1b26 !important;
        border-color: #73daca !important;
      }
      .incorrect {
        background-color: #f7768e !important;
        color: #1a1b26 !important;
        border-color: #db4b4b !important;
      }
      .option-btn {
        transition: all 0.2s;
        background-color: #24283b;
        border: 2px solid #414868;
        color: #c0caf5;
      }
      .option-btn:hover:not(:disabled) {
        border-color: #7aa2f7;
        background-color: #292e42;
        transform: translateY(-2px);
      }
      .hotkey-card {
        transition: all 0.2s ease;
        background-color: #24283b;
        border: 1px solid #414868;
      }
      .hotkey-card:hover {
        border-color: #7aa2f7;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }
      .custom-scroll::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scroll::-webkit-scrollbar-track {
        background: #1a1b26;
      }
      .custom-scroll::-webkit-scrollbar-thumb {
        background: #414868;
        border-radius: 10px;
      }

      /* Visual Keycap Styles */
      .kbd-key {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 24px;
        padding: 2px 8px;
        margin: 0 2px;
        border-radius: 6px;
        background: #16161e;
        border: 1px solid #565f89;
        box-shadow: 0 2px 0 #16161e;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.8rem;
        font-weight: 700;
        color: #bb9af7;
        transform: translateY(-1px);
      }
      .kbd-key.modifier {
        color: #7aa2f7;
        border-color: #414868;
      }
      .kbd-key.special {
        color: #e0af68;
        min-width: 40px;
      }
      .kbd-seq-separator {
        color: #565f89;
        font-size: 0.7rem;
        margin: 0 4px;
      }

      .nav-glass {
        background: rgba(26, 27, 38, 0.95);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body class="overflow-x-hidden">
    <!-- PayPal Donation Form -->
    <div
      class="bg-[#16161e] py-3 border-b border-[#414868] flex justify-center items-center sticky top-0 z-[100]"
    >
      <form action="https://www.paypal.com/donate" method="post" target="_top">
        <input type="hidden" name="hosted_button_id" value="RSW8PUWLJJ8DC" />
        <input
          type="image"
          src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif"
          border="0"
          name="submit"
          title="PayPal - The safer, easier way to pay online!"
          alt="Donate with PayPal button"
        />
        <img
          alt=""
          border="0"
          src="https://www.paypal.com/en_US/i/scr/pixel.gif"
          width="1"
          height="1"
        />
      </form>
    </div>

    <nav
      class="nav-glass border-b border-[#414868] sticky top-[52px] z-50 px-6 py-4 flex justify-between items-center shadow-lg"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center text-white font-black shadow-lg text-sm bg-gradient-to-br from-[#7aa2f7] to-[#bb9af7]"
        >
          Z
        </div>
        <a
          href="index.html"
          class="font-bold text-2xl tracking-tighter gradient-text"
          >Hotkey Trainer</a
        >
      </div>
      <a
        href="index.html"
        class="text-[#a9b1d6] hover:text-[#7aa2f7] transition-colors font-medium flex items-center gap-2"
      >
        <span>üè†</span> Home
      </a>
    </nav>

    <header
      class="bg-gradient-to-br from-[#1a1b26] via-[#24283b] to-[#16161e] py-12 text-center shadow-inner relative overflow-hidden border-b border-[#414868]"
    >
      <div
        class="absolute inset-0 opacity-5 pointer-events-none select-none text-[20rem] font-black -top-20 -right-10 text-white"
      >
        NVIM
      </div>
      <h1 class="text-6xl font-black mb-2 tracking-tight text-[#c0caf5]">
        LazyVim
      </h1>
      <p
        class="text-xl opacity-90 font-medium tracking-wide text-[#7aa2f7] mb-6"
      >
        Neovim for the ambitious.
      </p>

      <!-- Key Legend -->
      <div
        class="max-w-4xl mx-auto flex flex-wrap justify-center gap-4 text-xs font-mono bg-[#16161e]/50 p-4 rounded-xl border border-[#414868]/50"
      >
        <div class="flex items-center gap-2">
          <span class="kbd-key special">SPACE</span> =
          <span class="text-[#9ece6a]">&lt;leader&gt; Key</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="kbd-key modifier">CTRL</span> =
          <span class="text-[#c0caf5]">Control</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="kbd-key modifier">ALT</span> =
          <span class="text-[#c0caf5]">Alt/Option</span>
        </div>
        <div class="flex items-center gap-2 pl-4 border-l border-[#414868]">
          <span class="text-[#f7768e]">Note:</span> Super/Windows Key is
          <b>NOT</b> used to avoid OS conflicts.
        </div>
      </div>
    </header>

    <main
      class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-4 gap-8"
    >
      <!-- Sidebar Navigation -->
      <div class="lg:col-span-1 space-y-4">
        <div
          class="bg-[#24283b] rounded-3xl p-6 shadow-xl border border-[#414868] sticky top-40"
        >
          <h3
            class="text-sm font-black mb-4 text-[#565f89] uppercase tracking-widest px-2"
          >
            Modules
          </h3>
          <div
            class="space-y-1 max-h-[55vh] overflow-y-auto custom-scroll pr-2"
          >
            <button
              onclick="setMode('all')"
              id="mode-all"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl active-mode transition-all font-bold"
            >
              ‚å®Ô∏è All Keys
            </button>
            <button
              onclick="setMode('Essentials')"
              id="mode-Essentials"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl sidebar-btn transition-all font-semibold"
            >
              ‚ú® Essentials
            </button>
            <button
              onclick="setMode('Search')"
              id="mode-Search"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl sidebar-btn transition-all font-semibold"
            >
              üîç Search & Find
            </button>
            <button
              onclick="setMode('Coding')"
              id="mode-Coding"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl sidebar-btn transition-all font-semibold"
            >
              ‚ö° Coding & LSP
            </button>
            <button
              onclick="setMode('Git')"
              id="mode-Git"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl sidebar-btn transition-all font-semibold"
            >
              üåø Git & Plugins
            </button>
            <div class="h-px bg-[#414868] my-4"></div>
            <button
              onclick="setMode('quiz')"
              id="mode-quiz"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl hover:bg-[#7aa2f7] hover:text-[#1a1b26] transition-all font-black text-[#7aa2f7]"
            >
              üß† Start Gauntlet
            </button>
            <button
              onclick="setMode('insights')"
              id="mode-insights"
              class="mode-btn w-full text-left px-4 py-3 rounded-xl sidebar-btn transition-all font-semibold"
            >
              üìä Stats
            </button>
          </div>

          <div class="mt-8 pt-6 border-t border-[#414868] px-2">
            <h4
              class="text-[10px] font-black mb-3 text-[#565f89] uppercase tracking-widest"
            >
              Global Status
            </h4>
            <div class="space-y-4">
              <div class="flex justify-between items-end">
                <span class="text-xs text-[#a9b1d6] font-bold">Progress</span>
                <span class="font-black text-[#7aa2f7]" id="mastered-count"
                  >0</span
                >
              </div>
              <div class="w-full bg-[#16161e] rounded-full h-3">
                <div
                  class="bg-gradient-to-r from-[#7aa2f7] to-[#bb9af7] h-3 rounded-full transition-all duration-700 shadow-sm"
                  style="width: 0%"
                  id="progress-bar"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="lg:col-span-3">
        <div id="browser-view">
          <div
            class="bg-[#24283b] rounded-3xl p-6 shadow-xl border border-[#414868] mb-8"
          >
            <div class="relative">
              <input
                type="text"
                id="search-input"
                placeholder="Search command or key (e.g. 'File', 'Space c a')..."
                class="w-full px-6 py-4 pl-14 border border-[#414868] rounded-2xl bg-[#16161e] text-[#c0caf5] focus:ring-2 focus:ring-[#7aa2f7] outline-none transition-all text-lg font-medium placeholder-[#565f89]"
              />
              <div
                class="absolute left-6 top-1/2 transform -translate-y-1/2 text-[#565f89] text-xl"
              >
                üîç
              </div>
            </div>
          </div>
          <div
            id="hotkeys-container"
            class="grid grid-cols-1 md:grid-cols-2 gap-4"
          ></div>
        </div>

        <div id="quiz-container" class="hidden">
          <div
            class="bg-[#24283b] rounded-[3.5rem] p-12 shadow-2xl text-center border border-[#414868] min-h-[550px] flex flex-col justify-center"
          >
            <span
              class="bg-[#7aa2f7] text-[#1a1b26] px-6 py-2 rounded-full text-xs font-black uppercase tracking-widest inline-block mx-auto mb-10"
              >LazyVim Gauntlet</span
            >
            <h2 class="text-[#565f89] font-bold mb-2 uppercase text-xs">
              Identify the keybinding for:
            </h2>
            <h2
              id="quiz-question"
              class="text-4xl md:text-5xl font-black text-[#c0caf5] mb-14 leading-tight"
            >
              Loading...
            </h2>

            <div
              id="quiz-options"
              class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10"
            ></div>

            <div
              id="quiz-feedback"
              class="hidden p-8 rounded-3xl font-black text-2xl mb-8 transform transition-all duration-300"
            ></div>
            <button
              id="next-question-btn"
              onclick="nextQuestion()"
              class="hidden mx-auto bg-[#c0caf5] text-[#1a1b26] px-20 py-6 rounded-3xl font-black text-xl hover:bg-[#7aa2f7] transition-all hover:scale-105 shadow-2xl"
            >
              NEXT CHALLENGE ‚Üí
            </button>

            <div
              class="grid grid-cols-2 gap-6 mt-16 border-t border-[#414868] pt-10"
            >
              <div class="p-4 bg-[#16161e] rounded-2xl border border-[#9ece6a]">
                <p
                  class="text-[10px] font-black text-[#9ece6a] uppercase tracking-widest"
                >
                  Correct
                </p>
                <p
                  id="correct-count"
                  class="text-4xl font-black text-[#9ece6a]"
                >
                  0
                </p>
              </div>
              <div class="p-4 bg-[#16161e] rounded-2xl border border-[#f7768e]">
                <p
                  class="text-[10px] font-black text-[#f7768e] uppercase tracking-widest"
                >
                  Misses
                </p>
                <p
                  id="incorrect-count"
                  class="text-4xl font-black text-[#f7768e]"
                >
                  0
                </p>
              </div>
            </div>
          </div>
        </div>

        <div id="insights-container" class="hidden">
          <div
            class="bg-[#24283b] p-12 rounded-[3.5rem] shadow-2xl border border-[#414868] text-center"
          >
            <h2 class="text-3xl font-black mb-8 gradient-text font-black">
              Subconscious Mastery Analysis
            </h2>
            <div id="progress-chart" class="h-96 w-full mb-10"></div>

            <div class="max-w-3xl mx-auto text-left">
              <div class="flex items-center justify-between mb-6">
                <h3
                  class="text-xl font-black text-[#c0caf5] uppercase tracking-tighter flex items-center gap-2"
                >
                  <span>üöÄ</span> Streak-Earned Mastery
                </h3>
              </div>
              <div
                id="streak-list"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"
              >
                <!-- Items Injected -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer
      class="bg-[#16161e] text-[#565f89] py-12 mt-12 border-t border-[#414868]"
    >
      <div class="max-w-7xl mx-auto px-4 text-center">
        <p class="text-sm mb-4">Master your workflow, build the future.</p>
        <p class="text-xs">¬© 2025 thethreeplays.com. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Expanded & Clarified LazyVim Keybindings
      const hotkeysData = [
        // --- ESSENTIALS ---
        { func: "Save File", key: "<C-s>", cat: "Essentials" },
        {
          func: "Quit Buffer (Close tab)",
          key: "<leader> q q",
          cat: "Essentials",
        },
        {
          func: "Quit All / Exit Neovim",
          key: "<leader> q a",
          cat: "Essentials",
        },
        { func: "New Empty File", key: "<leader> f n", cat: "Essentials" },
        { func: "Move Focus Left", key: "<C-h>", cat: "Essentials" },
        { func: "Move Focus Down", key: "<C-j>", cat: "Essentials" },
        { func: "Move Focus Up", key: "<C-k>", cat: "Essentials" },
        { func: "Move Focus Right", key: "<C-l>", cat: "Essentials" },
        { func: "Resize Window Left", key: "<C-ArrowLeft>", cat: "Essentials" },
        { func: "Resize Window Down", key: "<C-ArrowDown>", cat: "Essentials" },
        { func: "Resize Window Up", key: "<C-ArrowUp>", cat: "Essentials" },
        {
          func: "Resize Window Right",
          key: "<C-ArrowRight>",
          cat: "Essentials",
        },
        { func: "Split Window Below", key: "<leader> -", cat: "Essentials" },
        { func: "Split Window Right", key: "<leader> |", cat: "Essentials" },
        { func: "Previous Buffer (Tab)", key: "<S-h>", cat: "Essentials" },
        { func: "Next Buffer (Tab)", key: "<S-l>", cat: "Essentials" },
        {
          func: "Delete/Close Current Buffer",
          key: "<leader> b d",
          cat: "Essentials",
        },
        {
          func: "Close All Other Buffers",
          key: "<leader> b o",
          cat: "Essentials",
        },
        { func: "Toggle Floating Terminal", key: "<C-/>", cat: "Essentials" },

        // --- SEARCH (Telescope) ---
        {
          func: "Find Files (Root Dir)",
          key: "<leader> <space>",
          cat: "Search",
        },
        {
          func: "Find Files (Current Dir)",
          key: "<leader> f f",
          cat: "Search",
        },
        { func: "Find Recent Files", key: "<leader> f r", cat: "Search" },
        { func: "List Open Buffers", key: "<leader> ,", cat: "Search" },
        { func: "Live Grep Text (Root)", key: "<leader> /", cat: "Search" },
        {
          func: "Live Grep Text (Current Dir)",
          key: "<leader> s g",
          cat: "Search",
        },
        { func: "Find Word Under Cursor", key: "<leader> s w", cat: "Search" },
        { func: "Command History", key: "<leader> :", cat: "Search" },
        { func: "Search Help Pages", key: "<leader> s h", cat: "Search" },
        { func: "Search Keymaps/Bindings", key: "<leader> s k", cat: "Search" },
        {
          func: "Toggle File Tree (Neo-tree)",
          key: "<leader> e",
          cat: "Search",
        },
        { func: "Flash Jump (Fast Navigation)", key: "s", cat: "Search" },

        // --- CODING & LSP ---
        { func: "Mason (Manage LSPs)", key: "<leader> c m", cat: "Coding" },
        { func: "LSP Info", key: "<leader> c l", cat: "Coding" },
        { func: "Format Document", key: "<leader> c f", cat: "Coding" },
        {
          func: "Rename Symbol (Refactor)",
          key: "<leader> c r",
          cat: "Coding",
        },
        { func: "Code Action (Quick Fix)", key: "<leader> c a", cat: "Coding" },
        { func: "Goto Definition", key: "g d", cat: "Coding" },
        { func: "Goto References", key: "g r", cat: "Coding" },
        { func: "Goto Implementation", key: "g I", cat: "Coding" },
        { func: "Goto Type Definition", key: "g y", cat: "Coding" },
        { func: "Hover Documentation", key: "K", cat: "Coding" },
        { func: "Signature Help (Params)", key: "g K", cat: "Coding" },
        { func: "Comment/Uncomment Line", key: "g c c", cat: "Coding" },
        { func: "Comment/Uncomment Selection", key: "g c", cat: "Coding" },
        {
          func: "Add Surround (e.g. quotes)",
          key: "g s a <char>",
          cat: "Coding",
        },
        { func: "Delete Surround", key: "g s d <char>", cat: "Coding" },
        { func: "Replace Surround", key: "g s r <char>", cat: "Coding" },

        // --- GIT & PLUGINS ---
        { func: "LazyGit Interface", key: "<leader> g g", cat: "Git" },
        { func: "Git Status", key: "<leader> g s", cat: "Git" },
        { func: "Git Blame Line", key: "<leader> g h b", cat: "Git" },
        { func: "Preview Git Hunk", key: "<leader> g h p", cat: "Git" },
        { func: "Reset Git Hunk", key: "<leader> g h r", cat: "Git" },
        { func: "Next Git Hunk", key: "] h", cat: "Git" },
        { func: "Previous Git Hunk", key: "[ h", cat: "Git" },
        { func: "Trouble (Error List)", key: "<leader> x x", cat: "Git" },
        { func: "Todo Comments List", key: "<leader> x t", cat: "Git" },
        { func: "Lazy Plugin Manager", key: "<leader> l", cat: "Git" },
        {
          func: "Show Notification History",
          key: "<leader> s n a",
          cat: "Git",
        },
        { func: "Toggle Word Wrap", key: "<leader> u w", cat: "Git" },
        { func: "Toggle Spelling", key: "<leader> u s", cat: "Git" },
        { func: "Toggle Line Numbers", key: "<leader> u l", cat: "Git" },
        { func: "Markdown Preview", key: "<leader> c p", cat: "Git" },
      ];

      let userProgress = {
        mastered: new Set(),
        streakCount: {},
      };
      let quizPool = [];
      let currentIdx = 0;
      let stats = { correct: 0, incorrect: 0 };
      let currentFilter = "all";

      function init() {
        loadMastery();
        renderHotkeys();
        setupSearch();
      }

      function renderKeyBadges(keyStr) {
        // Parse the key string into visual badges
        const parts = keyStr.split(" ");
        let html = "";

        parts.forEach((part, index) => {
          let content = part;
          let className = "kbd-key";

          if (part.includes("<leader>")) {
            content = "SPACE";
            className += " special";
          } else if (part.includes("<space>")) {
            content = "SPACE";
            className += " special";
          } else if (part.includes("<C-")) {
            content = "CTRL + " + part.replace("<C-", "").replace(">", "");
            className += " modifier";
          } else if (part.includes("<S-")) {
            content = "SHIFT + " + part.replace("<S-", "").replace(">", "");
            className += " modifier";
          } else if (part.includes("<A-")) {
            content = "ALT + " + part.replace("<A-", "").replace(">", "");
            className += " modifier";
          } else if (part === "<CR>") {
            content = "ENTER";
            className += " modifier";
          } else if (part.includes("Arrow")) {
            content = part.replace("Arrow", ""); // Left, Right etc
          }

          // Check if it's a single letter char that looks better uppercase in badge
          if (content.length === 1) content = content;

          html += `<span class="${className}">${content}</span>`;
        });

        return html;
      }

      function setMode(mode) {
        document
          .querySelectorAll(".mode-btn")
          .forEach((btn) => btn.classList.remove("active-mode"));
        const targetBtn = document.getElementById(`mode-${mode}`);
        if (targetBtn) targetBtn.classList.add("active-mode");

        const views = {
          "browser-view": document.getElementById("browser-view"),
          "quiz-container": document.getElementById("quiz-container"),
          "insights-container": document.getElementById("insights-container"),
        };

        Object.values(views).forEach((v) => v.classList.add("hidden"));

        if (mode === "quiz") {
          views["quiz-container"].classList.remove("hidden");
          startQuiz();
        } else if (mode === "insights") {
          views["insights-container"].classList.remove("hidden");
          drawInsights();
        } else {
          views["browser-view"].classList.remove("hidden");
          currentFilter = mode;
          renderHotkeys();
        }
      }

      function updateStats() {
        const mCount = userProgress.mastered.size;
        const total = hotkeysData.length;
        const masteredEl = document.getElementById("mastered-count");
        const progressEl = document.getElementById("progress-bar");
        if (masteredEl) masteredEl.innerText = mCount + " / " + total;
        if (progressEl)
          progressEl.style.width = Math.round((mCount / total) * 100) + "%";
      }

      function renderHotkeys(search = "") {
        const container = document.getElementById("hotkeys-container");
        container.innerHTML = "";
        let filtered = hotkeysData;
        if (currentFilter !== "all")
          filtered = filtered.filter((h) => h.cat === currentFilter);
        if (search)
          filtered = filtered.filter(
            (h) =>
              h.func.toLowerCase().includes(search.toLowerCase()) ||
              h.key.toLowerCase().includes(search.toLowerCase())
          );

        filtered.forEach((h) => {
          const card = document.createElement("div");
          const mastered = userProgress.mastered.has(h.func);
          const streak = userProgress.streakCount[h.func] || 0;

          card.className = `hotkey-card p-6 rounded-3xl border flex justify-between items-center group transition-all ${
            mastered
              ? "border-[#9ece6a] bg-[#1a1b26]/50"
              : "bg-[#24283b] border-[#414868]"
          }`;

          let streakHtml = "";
          if (mastered) {
            streakHtml = `<span class="text-[9px] font-black bg-[#9ece6a] text-[#1a1b26] px-2 py-0.5 rounded-full uppercase ml-2">Mastered</span>`;
          } else if (streak > 0) {
            streakHtml = `<span class="text-[9px] font-black bg-[#7aa2f7] text-[#1a1b26] px-2 py-0.5 rounded-full uppercase ml-2">Streak: ${streak}/5</span>`;
          }

          // Generate Mnemonic Hint
          let hint = "";
          if (h.key.includes("<leader>")) {
            // Basic naive heuristic for hints
            if (h.key.includes("c a")) hint = "c=Code, a=Action";
            else if (h.key.includes("f f")) hint = "f=Find, f=Files";
            else if (h.key.includes("g g")) hint = "g=Git, g=GUI";
            else if (h.key.includes("b d")) hint = "b=Buffer, d=Delete";
          }

          card.innerHTML = `
                    <div class="flex-grow">
                        <div class="flex items-center gap-2 mb-1">
                            <p class="text-[9px] font-black text-[#565f89] uppercase group-hover:text-[#7aa2f7]">${
                              h.cat
                            }</p>
                            ${streakHtml}
                        </div>
                        <h4 class="text-md font-bold text-[#c0caf5] mb-1">${
                          h.func
                        }</h4>
                        ${
                          hint
                            ? `<p class="text-[10px] text-[#565f89] font-mono opacity-0 group-hover:opacity-100 transition-opacity">üí° ${hint}</p>`
                            : ""
                        }
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center">
                            ${renderKeyBadges(h.key)}
                        </div>
                        <button onclick="toggleStar('${
                          h.func
                        }')" class="text-2xl transform hover:scale-125 transition-transform text-[#565f89] hover:text-[#e0af68] ml-2">${
            mastered ? "‚≠ê" : "‚òÜ"
          }</button>
                    </div>`;
          container.appendChild(card);
        });
        updateStats();
      }

      function startQuiz() {
        quizPool = [...hotkeysData];
        shuffle(quizPool);
        currentIdx = 0;
        stats = { correct: 0, incorrect: 0 };
        document.getElementById("correct-count").innerText = "0";
        document.getElementById("incorrect-count").innerText = "0";
        loadQuestion();
      }

      function loadQuestion() {
        const q = quizPool[currentIdx];
        document.getElementById("quiz-question").innerText = q.func;
        document.getElementById("quiz-feedback").classList.add("hidden");
        document.getElementById("next-question-btn").classList.add("hidden");
        const options = document.getElementById("quiz-options");
        options.innerHTML = "";
        options.classList.remove("pointer-events-none");

        let choices = [q.key];
        while (choices.length < 4) {
          let r =
            hotkeysData[Math.floor(Math.random() * hotkeysData.length)].key;
          if (!choices.includes(r)) choices.push(r);
        }
        shuffle(choices);

        choices.forEach((c) => {
          const btn = document.createElement("button");
          btn.className =
            "option-btn p-6 rounded-3xl font-black text-xl shadow-md flex justify-center items-center gap-2";

          // Render visual badges inside button
          btn.innerHTML = renderKeyBadges(c);

          btn.onclick = () => {
            const isCorrect = c === q.key;
            options.classList.add("pointer-events-none");
            btn.classList.add(isCorrect ? "correct" : "incorrect");

            if (isCorrect) {
              stats.correct++;
              userProgress.streakCount[q.func] =
                (userProgress.streakCount[q.func] || 0) + 1;
              if (
                userProgress.streakCount[q.func] >= 5 &&
                !userProgress.mastered.has(q.func)
              ) {
                userProgress.mastered.add(q.func);
              }
            } else {
              stats.incorrect++;
              userProgress.streakCount[q.func] = 0;
              document.querySelectorAll(".option-btn").forEach((b) => {
                // Check innerHTML text content logic or just compare visually
                // Since we render HTML now, we compare the source data logic:
                // We'll just highlight the one that matches q.key by regenerating badges?
                // Easier: just look for the button that wasn't clicked
              });
              // Highlight correct answer
              Array.from(options.children).forEach((child) => {
                // Re-render badges to check text content is hard, so we just check against logic
                // Since we don't store key on button easily, we just iterate logic:
                // Actually we can't easily find it without storing it.
                // Let's rely on user finding it or just showing feedback text.
              });
            }

            saveMastery();
            const feed = document.getElementById("quiz-feedback");
            feed.innerHTML = isCorrect
              ? "PERFECT! Workflow optimized."
              : `The correct combo is: <div class='inline-flex scale-75 origin-left ml-2'>${renderKeyBadges(
                  q.key
                )}</div>`;

            feed.className = `p-8 rounded-3xl font-black text-2xl mb-8 border-4 ${
              isCorrect
                ? "bg-[#16161e] text-[#9ece6a] border-[#9ece6a]"
                : "bg-[#16161e] text-[#f7768e] border-[#f7768e]"
            }`;
            feed.classList.remove("hidden");
            document
              .getElementById("next-question-btn")
              .classList.remove("hidden");
            document.getElementById("correct-count").innerText = stats.correct;
            document.getElementById("incorrect-count").innerText =
              stats.incorrect;
            updateStats();
          };
          options.appendChild(btn);
        });
      }

      function nextQuestion() {
        currentIdx++;
        if (currentIdx < quizPool.length) loadQuestion();
        else startQuiz();
      }

      function toggleStar(f) {
        if (userProgress.mastered.has(f)) {
          userProgress.mastered.delete(f);
          userProgress.streakCount[f] = 0;
        } else {
          userProgress.mastered.add(f);
          userProgress.streakCount[f] = 5;
        }
        saveMastery();
        renderHotkeys();
      }

      function setupSearch() {
        document
          .getElementById("search-input")
          .addEventListener("input", (e) => renderHotkeys(e.target.value));
      }
      function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
      }

      function saveMastery() {
        localStorage.setItem(
          "mastery-lazyvim-v1",
          JSON.stringify({
            mastered: [...userProgress.mastered],
            streaks: userProgress.streakCount,
          })
        );
      }

      function loadMastery() {
        const s = localStorage.getItem("mastery-lazyvim-v1");
        if (s) {
          const data = JSON.parse(s);
          userProgress.mastered = new Set(data.mastered || []);
          userProgress.streakCount = data.streaks || {};
        }
      }

      function drawInsights() {
        const m = userProgress.mastered.size;
        const r = hotkeysData.length - m;

        if (typeof Plotly !== "undefined") {
          Plotly.newPlot(
            "progress-chart",
            [
              {
                values: [m, r],
                labels: ["Mastered", "Remaining"],
                type: "pie",
                marker: { colors: ["#9ece6a", "#1a1b26"] },
                hole: 0.5,
              },
            ],
            {
              margin: { t: 0, b: 0, l: 0, r: 0 },
              paper_bgcolor: "rgba(0,0,0,0)",
              plot_bgcolor: "rgba(0,0,0,0)",
              font: { color: "#a9b1d6" },
              showlegend: false,
            }
          );
        }

        const list = document.getElementById("streak-list");
        list.innerHTML = "";
        let streakItemsCount = 0;

        Object.entries(userProgress.streakCount).forEach(([name, count]) => {
          if (count >= 5) {
            streakItemsCount++;
            const item = document.createElement("div");
            item.className =
              "bg-[#24283b] border border-[#9ece6a] p-4 rounded-2xl flex justify-between items-center shadow-sm animate-in slide-in-from-bottom duration-500";
            item.innerHTML = `<span class="font-bold text-[#c0caf5] text-xs">${name}</span><span class="bg-[#9ece6a] text-[#1a1b26] text-[8px] px-2 py-0.5 rounded-lg font-black uppercase italic">MASTER</span>`;
            list.appendChild(item);
          }
        });

        if (streakItemsCount === 0) {
          list.innerHTML =
            '<div class="col-span-3 p-8 text-center bg-[#16161e] rounded-3xl border-2 border-dashed border-[#414868]"><p class="text-[#565f89] text-sm font-medium">Get a 5-streak in the Gauntlet to graduate keys to mastery.</p></div>';
        }
        updateStats();
      }

      window.onload = () => {
        init();
      };
    </script>
  </body>
</html>
